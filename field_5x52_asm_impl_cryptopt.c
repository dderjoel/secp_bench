#include "field_5x52_asm_impl_cryptopt.h"

void secp256k1_fe_mul_inner(uint64_t *r, const uint64_t *a,
                            const uint64_t *SECP256K1_RESTRICT b) {
  __asm__ __volatile__(
      "mov    %%rdx,%%rax\n"
      "mov    0x20(%%rsi),%%rdx\n"
      "mulx   (%%rax),%%r10,%%r11\n"
      "mov    (%%rax),%%rdx\n"
      "mulx   0x18(%%rsi),%%rcx,%%r8\n"
      "mov    0x10(%%rsi),%%rdx\n"
      "mov    %%rbx,-0x80(%%rsp)\n"
      "mulx   0x10(%%rax),%%r9,%%rbx\n"
      "mov    0x8(%%rax),%%rdx\n"
      "mov    %%rbp,-0x78(%%rsp)\n"
      "mov    %%r12,-0x70(%%rsp)\n"
      "mulx   0x10(%%rsi),%%rbp,%%r12\n"
      "xor    %%rdx,%%rdx\n"
      "adox   %%rbp,%%rcx\n"
      "adox   %%r8,%%r12\n"
      "mov    0x20(%%rsi),%%rdx\n"
      "mulx   0x20(%%rax),%%r8,%%rbp\n"
      "mov    0x8(%%rax),%%rdx\n"
      "mov    %%r13,-0x68(%%rsp)\n"
      "mov    %%r14,-0x60(%%rsp)\n"
      "mulx   0x18(%%rsi),%%r13,%%r14\n"
      "adcx   %%r13,%%r10\n"
      "adcx   %%r11,%%r14\n"
      "mov    0x8(%%rsi),%%rdx\n"
      "mulx   0x10(%%rax),%%r11,%%r13\n"
      "mov    0x18(%%rax),%%rdx\n"
      "mov    %%r15,-0x58(%%rsp)\n"
      "mov    %%rdi,-0x50(%%rsp)\n"
      "mulx   (%%rsi),%%r15,%%rdi\n"
      "add    %%r11,%%rcx\n"
      "adcx   %%r12,%%r13\n"
      "add    %%r15,%%rcx\n"
      "adcx   %%r13,%%rdi\n"
      "movabs $0x1000003d10,%%rdx\n"
      "mulx   %%r8,%%r12,%%r11\n"
      "add    %%rcx,%%r12\n"
      "adcx   %%r11,%%rdi\n"
      "mov    0x18(%%rax),%%rdx\n"
      "mulx   0x8(%%rsi),%%r15,%%r13\n"
      "mov    %%r12,%%rdx\n"
      "shrd   $0x34,%%rdi,%%rdx\n"
      "xor    %%r8,%%r8\n"
      "adox   %%r9,%%r10\n"
      "adox   %%r14,%%rbx\n"
      "adcx   %%r15,%%r10\n"
      "adcx   %%rbx,%%r13\n"
      "mov    %%rdx,%%r9\n"
      "mov    (%%rsi),%%rdx\n"
      "mulx   0x20(%%rax),%%r14,%%rcx\n"
      "xor    %%rdx,%%rdx\n"
      "adox   %%r14,%%r10\n"
      "adox   %%r13,%%rcx\n"
      "mov    0x8(%%rax),%%rdx\n"
      "mulx   0x20(%%rsi),%%r8,%%r11\n"
      "adcx   %%r10,%%r9\n"
      "adc    $0x0,%%rcx\n"
      "mov    0x10(%%rax),%%rdx\n"
      "mulx   0x18(%%rsi),%%rdi,%%r15\n"
      "test   %%al,%%al\n"
      "adox   %%rdi,%%r8\n"
      "adox   %%r11,%%r15\n"
      "mov    0x10(%%rsi),%%rdx\n"
      "mulx   0x18(%%rax),%%rbx,%%r13\n"
      "movabs $0x1000003d10000,%%rdx\n"
      "mulx   %%rbp,%%r14,%%r10\n"
      "mov    0x8(%%rsi),%%rdx\n"
      "mulx   0x20(%%rax),%%rbp,%%r11\n"
      "adcx   %%r9,%%r14\n"
      "adcx   %%r10,%%rcx\n"
      "movabs $0xfffffffffffff,%%rdx\n"
      "mov    %%r14,%%r9\n"
      "and    %%rdx,%%r9\n"
      "adox   %%rbx,%%r8\n"
      "adox   %%r15,%%r13\n"
      "movabs $0xffffffffffff,%%rdi\n"
      "mov    %%r9,%%r15\n"
      "and    %%rdi,%%r15\n"
      "adox   %%rbp,%%r8\n"
      "adox   %%r13,%%r11\n"
      "shrd   $0x34,%%rcx,%%r14\n"
      "test   %%al,%%al\n"
      "adox   %%r8,%%r14\n"
      "mov    $0x0,%%ebx\n"
      "adox   %%rbx,%%r11\n"
      "mov    %%r14,%%r10\n"
      "and    %%rdx,%%r10\n"
      "shl    $0x4,%%r10\n"
      "shr    $0x30,%%r9\n"
      "lea    (%%r10,%%r9,1),%%r10\n"
      "mov    (%%rax),%%rdx\n"
      "mulx   (%%rsi),%%rbp,%%rcx\n"
      "movabs $0x1000003d1,%%rdx\n"
      "mulx   %%r10,%%r13,%%r8\n"
      "mov    0x18(%%rax),%%rdx\n"
      "mulx   0x18(%%rsi),%%r9,%%r10\n"
      "mov    0x20(%%rsi),%%rdx\n"
      "mulx   0x10(%%rax),%%rbx,%%rdi\n"
      "xor    %%rdx,%%rdx\n"
      "adox   %%r9,%%rbx\n"
      "adox   %%rdi,%%r10\n"
      "mov    0x20(%%rax),%%rdx\n"
      "mulx   0x10(%%rsi),%%r9,%%rdi\n"
      "adcx   %%r9,%%rbx\n"
      "adcx   %%r10,%%rdi\n"
      "shrd   $0x34,%%r11,%%r14\n"
      "add    %%rbx,%%r14\n"
      "adc    $0x0,%%rdi\n"
      "mov    (%%rax),%%rdx\n"
      "mulx   0x8(%%rsi),%%r11,%%r10\n"
      "mov    (%%rsi),%%rdx\n"
      "mulx   0x8(%%rax),%%r9,%%rbx\n"
      "mov    0x10(%%rsi),%%rdx\n"
      "mov    %%r15,-0x48(%%rsp)\n"
      "mov    %%rdi,-0x40(%%rsp)\n"
      "mulx   (%%rax),%%r15,%%rdi\n"
      "xor    %%rdx,%%rdx\n"
      "adox   %%r9,%%r11\n"
      "adox   %%r10,%%rbx\n"
      "adcx   %%rbp,%%r13\n"
      "adcx   %%r8,%%rcx\n"
      "mov    -0x40(%%rsp),%%rbp\n"
      "mov    %%r14,%%r8\n"
      "shrd   $0x34,%%rbp,%%r8\n"
      "mov    0x8(%%rax),%%rdx\n"
      "mulx   0x8(%%rsi),%%rbp,%%r10\n"
      "mov    %%r13,%%rdx\n"
      "shrd   $0x34,%%rcx,%%rdx\n"
      "xor    %%r9,%%r9\n"
      "adox   %%r11,%%rdx\n"
      "adox   %%r9,%%rbx\n"
      "mov    %%rdx,%%r11\n"
      "mov    0x18(%%rsi),%%rdx\n"
      "mulx   0x20(%%rax),%%rcx,%%r9\n"
      "adcx   %%rbp,%%r15\n"
      "adcx   %%rdi,%%r10\n"
      "mov    0x18(%%rax),%%rdx\n"
      "mulx   0x20(%%rsi),%%rdi,%%rbp\n"
      "xor    %%rdx,%%rdx\n"
      "adox   %%rcx,%%rdi\n"
      "adox   %%rbp,%%r9\n"
      "adcx   %%rdi,%%r8\n"
      "adc    $0x0,%%r9\n"
      "movabs $0xfffffffffffff,%%rcx\n"
      "and    %%rcx,%%r14\n"
      "mov    0x10(%%rax),%%rdx\n"
      "mulx   (%%rsi),%%rbp,%%rdi\n"
      "adox   %%rbp,%%r15\n"
      "adox   %%r10,%%rdi\n"
      "movabs $0x1000003d10,%%rdx\n"
      "mulx   %%r14,%%r10,%%rbp\n"
      "adcx   %%r11,%%r10\n"
      "adcx   %%rbp,%%rbx\n"
      "mov    %%r10,%%r11\n"
      "shrd   $0x34,%%rbx,%%r11\n"
      "and    %%rcx,%%r10\n"
      "mulx   %%r8,%%r14,%%rbp\n"
      "movabs $0x1000003d10000,%%r8\n"
      "mov    %%r9,%%rdx\n"
      "mulx   %%r8,%%r9,%%rbx\n"
      "adox   %%r15,%%r11\n"
      "mov    $0x0,%%edx\n"
      "adox   %%rdx,%%rdi\n"
      "adcx   %%r11,%%r14\n"
      "adcx   %%rbp,%%rdi\n"
      "mov    %%r14,%%r15\n"
      "shrd   $0x34,%%rdi,%%r15\n"
      "mov    -0x50(%%rsp),%%rbp\n"
      "mov    %%r10,0x8(%%rbp)\n"
      "and    %%rcx,%%r12\n"
      "lea    (%%r12,%%r15,1),%%r12\n"
      "adox   %%r12,%%r9\n"
      "adox   %%rdx,%%rbx\n"
      "and    %%rcx,%%r13\n"
      "mov    %%r13,0x0(%%rbp)\n"
      "and    %%rcx,%%r14\n"
      "mov    %%r9,%%r10\n"
      "shrd   $0x34,%%rbx,%%r10\n"
      "mov    %%r14,0x10(%%rbp)\n"
      "add    -0x48(%%rsp),%%r10\n"
      "and    %%rcx,%%r9\n"
      "mov    %%r10,0x20(%%rbp)\n"
      "mov    %%r9,0x18(%%rbp)\n"
      "mov    -0x80(%%rsp),%%rbx\n"
      "mov    -0x78(%%rsp),%%rbp\n"
      "mov    -0x70(%%rsp),%%r12\n"
      "mov    -0x68(%%rsp),%%r13\n"
      "mov    -0x60(%%rsp),%%r14\n"
      "mov    -0x58(%%rsp),%%r15\n"

      : "=m"(r[0]), "=m"(r[1]), "=m"(r[2]), "=m"(r[3]), "=m"(r[4])

      : "D"(r), "S"(a), "d"(b), "m"(a[0]), "m"(b[0]), "m"(a[1]), "m"(b[1]),
        "m"(a[2]), "m"(b[2]), "m"(a[3]), "m"(b[3]), "m"(a[4]), "m"(b[4])
      : "cc", "memory");
}

void secp256k1_fe_sqr_inner(uint64_t *r, const uint64_t *a) {

  __asm__ __volatile__(
      "mov    0x8(%%rsi),%%rax\n"
      "lea    (%%rax,%%rax,1),%%r10\n"
      "mov    0x20(%%rsi),%%rdx\n"
      "mulx   %%rdx,%%rax,%%r11\n"
      "mov    (%%rsi),%%rdx\n"
      "mov    %%rdx,%%rcx\n"
      "shl    %%rcx\n"
      "mov    0x10(%%rsi),%%rdx\n"
      "mulx   %%r10,%%r8,%%r9\n"
      "mov    0x18(%%rsi),%%rdx\n"
      "mov    %%rbx,-0x80(%%rsp)\n"
      "mov    %%rbp,-0x78(%%rsp)\n"
      "mulx   %%rcx,%%rbx,%%rbp\n"
      "xor    %%rdx,%%rdx\n"
      "adox   %%rbx,%%r8\n"
      "adox   %%r9,%%rbp\n"
      "movabs $0x1000003d10,%%r9\n"
      "mov    %%rax,%%rdx\n"
      "mulx   %%r9,%%rax,%%rbx\n"
      "adcx   %%r8,%%rax\n"
      "adcx   %%rbx,%%rbp\n"
      "mov    %%rax,%%r8\n"
      "shrd   $0x34,%%rbp,%%r8\n"
      "mov    0x10(%%rsi),%%rdx\n"
      "mulx   %%rdx,%%rbx,%%rbp\n"
      "mov    %%r10,%%rdx\n"
      "mov    %%r12,-0x70(%%rsp)\n"
      "mulx   0x18(%%rsi),%%r10,%%r12\n"
      "mov    %%r13,-0x68(%%rsp)\n"
      "xor    %%r13,%%r13\n"
      "adox   %%r10,%%rbx\n"
      "adox   %%rbp,%%r12\n"
      "mov    %%rdx,%%rbp\n"
      "mov    0x20(%%rsi),%%rdx\n"
      "mulx   %%rcx,%%r10,%%r13\n"
      "adcx   %%r10,%%rbx\n"
      "adcx   %%r12,%%r13\n"
      "movabs $0x1000003d10000,%%rdx\n"
      "mulx   %%r11,%%r12,%%r10\n"
      "mov    %%rbp,%%rdx\n"
      "mulx   0x20(%%rsi),%%rbp,%%r11\n"
      "add    %%rbx,%%r8\n"
      "adc    $0x0,%%r13\n"
      "mov    0x10(%%rsi),%%rdx\n"
      "lea    (%%rdx,%%rdx,1),%%rbx\n"
      "mov    %%rbx,%%rdx\n"
      "mov    %%r14,-0x60(%%rsp)\n"
      "mulx   0x20(%%rsi),%%rbx,%%r14\n"
      "mov    %%r15,-0x58(%%rsp)\n"
      "xor    %%r15,%%r15\n"
      "adox   %%r8,%%r12\n"
      "adox   %%r10,%%r13\n"
      "mulx   0x18(%%rsi),%%r10,%%r8\n"
      "adcx   %%rbp,%%r10\n"
      "adcx   %%r8,%%r11\n"
      "mov    %%r12,%%rbp\n"
      "shrd   $0x34,%%r13,%%rbp\n"
      "add    %%r10,%%rbp\n"
      "adc    $0x0,%%r11\n"
      "movabs $0xfffffffffffff,%%rdx\n"
      "mov    %%rbp,%%r13\n"
      "and    %%rdx,%%r13\n"
      "shl    $0x4,%%r13\n"
      "and    %%rdx,%%r12\n"
      "mov    %%r12,%%r8\n"
      "shr    $0x30,%%r8\n"
      "mov    0x18(%%rsi),%%rdx\n"
      "mulx   %%rdx,%%r10,%%r15\n"
      "lea    0x0(%%r13,%%r8,1),%%r13\n"
      "shrd   $0x34,%%r11,%%rbp\n"
      "xor    %%rdx,%%rdx\n"
      "adox   %%rbx,%%r10\n"
      "adox   %%r15,%%r14\n"
      "adcx   %%r10,%%rbp\n"
      "adc    $0x0,%%r14\n"
      "imul   $0x2,0x18(%%rsi),%%rbx\n"
      "mov    %%rbp,%%r11\n"
      "shrd   $0x34,%%r14,%%r11\n"
      "mov    (%%rsi),%%rdx\n"
      "mulx   %%rdx,%%r8,%%r15\n"
      "movabs $0x1000003d1,%%rdx\n"
      "mulx   %%r13,%%r10,%%r14\n"
      "mov    %%rbx,%%rdx\n"
      "mulx   0x20(%%rsi),%%rbx,%%r13\n"
      "xor    %%rdx,%%rdx\n"
      "adox   %%rbx,%%r11\n"
      "adox   %%rdx,%%r13\n"
      "adcx   %%r8,%%r10\n"
      "adcx   %%r14,%%r15\n"
      "movabs $0xfffffffffffff,%%r8\n"
      "and    %%r8,%%rbp\n"
      "mov    %%rbp,%%rdx\n"
      "mulx   %%r9,%%rbp,%%r14\n"
      "mov    %%r10,%%rbx\n"
      "shrd   $0x34,%%r15,%%rbx\n"
      "mov    0x8(%%rsi),%%rdx\n"
      "mulx   %%rcx,%%r15,%%r9\n"
      "add    %%r15,%%rbx\n"
      "adc    $0x0,%%r9\n"
      "xor    %%rdx,%%rdx\n"
      "adox   %%rbx,%%rbp\n"
      "adox   %%r14,%%r9\n"
      "mov    %%rbp,%%r14\n"
      "shrd   $0x34,%%r9,%%r14\n"
      "mov    %%rcx,%%rdx\n"
      "mulx   0x10(%%rsi),%%rcx,%%r15\n"
      "mov    0x8(%%rsi),%%rdx\n"
      "mulx   %%rdx,%%rbx,%%r9\n"
      "add    %%rcx,%%rbx\n"
      "adcx   %%r9,%%r15\n"
      "add    %%rbx,%%r14\n"
      "adc    $0x0,%%r15\n"
      "movabs $0x1000003d10,%%rdx\n"
      "mulx   %%r11,%%rcx,%%r9\n"
      "xor    %%r11,%%r11\n"
      "adox   %%r14,%%rcx\n"
      "adox   %%r9,%%r15\n"
      "mov    %%rcx,%%rbx\n"
      "shrd   $0x34,%%r15,%%rbx\n"
      "and    %%r8,%%rcx\n"
      "and    %%r8,%%rax\n"
      "mov    %%rcx,0x10(%%rdi)\n"
      "lea    (%%rax,%%rbx,1),%%rax\n"
      "movabs $0xffffffffffff,%%r14\n"
      "and    %%r14,%%r12\n"
      "and    %%r8,%%rbp\n"
      "mov    %%rbp,0x8(%%rdi)\n"
      "movabs $0x1000003d10000,%%r9\n"
      "mov    %%r9,%%rdx\n"
      "mulx   %%r13,%%r9,%%r15\n"
      "adox   %%rax,%%r9\n"
      "adox   %%r11,%%r15\n"
      "and    %%r8,%%r10\n"
      "mov    %%r9,%%r13\n"
      "shrd   $0x34,%%r15,%%r13\n"
      "and    %%r8,%%r9\n"
      "lea    (%%r12,%%r13,1),%%r12\n"
      "mov    %%r12,0x20(%%rdi)\n"
      "mov    %%r10,(%%rdi)\n"
      "mov    %%r9,0x18(%%rdi)\n"
      "mov    -0x80(%%rsp),%%rbx\n"
      "mov    -0x78(%%rsp),%%rbp\n"
      "mov    -0x70(%%rsp),%%r12\n"
      "mov    -0x68(%%rsp),%%r13\n"
      "mov    -0x60(%%rsp),%%r14\n"
      "mov    -0x58(%%rsp),%%r15\n"

      : "=m"(r[0]), "=m"(r[1]), "=m"(r[2]), "=m"(r[3]), "=m"(r[4])
      : "D"(r), "S"(a), "m"(a[0]), "m"(a[1]), "m"(a[2]), "m"(a[3]), "m"(a[4])
      : "cc", "memory");
}
